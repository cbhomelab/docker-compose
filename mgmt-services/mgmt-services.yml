# This file is auto-generated by openmediavault (https://www.openmediavault.org)
# WARNING: Do not edit this file, your changes will get lost.

# mgmt-services
# Services on Management Network
---
networks:
  mgmt_bridge:
    name: mgmt_bridge
    driver: ipvlan
    driver_opts:
      parent: enp4s0
    ipam:
      config:
        - subnet: "10.20.0.0/24"
          gateway: "10.20.0.1"
  docker:
    name: docker
    external: true
services:
  krusader:
    container_name: Krusader
    networks:
      mgmt_bridge:
        ipv4_address: ${krusaderip}
    environment:
      - PUID=${dockeruid}
      - PGID=${dockergid}
      - TZ=${timezone}
      - USER_LOCALES=en_US.UTF-8 UTF8
      - CUSTOM_RES_W=1280
      - CUSTOM_RES_H=1024
      - UMASK=000
    volumes:
      - ${appdata}/krusader:/krusader:rw
      - ${remotes}:/mnt:rw
      - ${media}:/data/media:rw
      - ${appdata}:/data/appdata:rw
      - ${downloads}:/data/downloads:rw
    deploy:
      resources:
          limits:
              pids: 2048
              memory: 1G
    logging:
      options:
          max-size: 50m
    restart: unless-stopped
    image: ich777/krusader
  auto-m4b:
    image: seanap/auto-m4b
    container_name: auto-m4b
    network_mode: "host"
    environment:
      - PUID=${dockeruid}
      - PGID=${dockergid}
      - TZ=${timezone}
    volumes:
      - ${appdata}/auto-m4b:/config:rw
      - ${downloads}/audiobook_processing:/temp:rw
    deploy:
        resources:
            limits:
                pids: 2048
                memory: 1G
    logging:
        options:
            max-size: 50m
  fileflows:
    image: revenz/fileflows
    container_name: fileflows
    restart: unless-stopped
    environment:
      - PUID=${dockeruid}
      - PGID=${dockergid}
      - TZ=${timezone}
    networks:
      mgmt_bridge:
        ipv4_address: ${fileflowsip}
    ports:
      - "5000:5000"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ${appdata}/fileflows/data:/app/data:rw
      - ${appdata}/fileflows/logs:/app/logs:rw
      - ${media}/tv:/tv:rw
      - ${media}/movies:/movies:rw
      - ${media}/youtube:/youtube:rw
      - ${media}/dvr:/dvr:rw
      - ${media}/audiobooks:/audiobooks:rw
      - ${media}/music:/music:rw
      - ${intel}:rw
    deploy:
      resources:
          limits:
              pids: 2048
              memory: 16G
    logging:
        options:
            max-size: 50m
    devices:
      # - /dev/dri:/dev/dri
      - ${intel}
  minio:
    image: ghcr.io/imagegenius/minio:latest
    container_name: minio
    network_mode: "host"
    environment:
      - PUID=${dockeruid}
      - PGID=${dockergid}
      - TZ=${timezone}
      - MINIO_ROOT_USER=minio
      - MINIO_ROOT_PASSWORD=${minio-root-pass}
    volumes:
      - ${media}:/config:rw
    ports:
      - 9001:9001
      - 9000:9000
    restart: unless-stopped
    deploy:
      resources:
          limits:
              pids: 2048
              memory: 4G
    logging:
        options:
            max-size: 50m
  frigate:
    container_name: frigate
    privileged: true # this may not be necessary for all setups
    restart: unless-stopped
    networks:
      mgmt_bridge:
        ipv4_address: ${frigateip}
    stop_grace_period: 30s # allow enough time to shut down the various services
    image: ghcr.io/blakeblackshear/frigate:stable
    shm_size: "512mb" # update for your cameras based on calculation above
    devices:
      - ${coral}
      - ${intel}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${appdata}/frigate:/config:rw
      - ${media}/cctv:/media/frigate:rw
      - ${intel}:rw
      - type: tmpfs # Optional: 1GB of memory, reduces SSD/SD Card wear
        target: /tmp/cache
        tmpfs:
          size: 1000000000
    environment:
      FRIGATE_RTSP_PASSWORD: "${frigatertsppassword}"
